

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏£ ‡∏ô‡∏®‡∏ó.‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏±‡∏ï‡∏ô‡πå‡∏û‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0f7ff;
        }
        
        @media print {
            body {
                background-color: white;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .print-container {
                width: 297mm;
                height: 210mm;
                margin: 0;
                padding: 0;
            }
            
            .no-print {
                display: none;
            }
            
            input {
                border: none !important;
            }
            
            .page-break {
                page-break-after: always;
            }
        }
        
        .duty-table th, .duty-table td {
            border: 1px solid #b0c4de;
        }
        
        .checkbox {
            width: 16px;
            height: 16px;
            border: 1px solid #2c5282;
            display: inline-block;
            position: relative;
            background-color: white;
            margin: 0 auto;
            cursor: pointer;
        }
        
        .checkbox.‡∏°‡∏≤::after {
            content: '‚úÖ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }
        
        .checkbox.‡∏•‡∏≤::after {
            content: 'üìë';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }
        
        .checkbox.‡∏™‡∏≤‡∏¢::after {
            content: '‚è∞';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }
        
        .checkbox.‡∏Ç‡∏≤‡∏î::after {
            content: '‚ùå';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }
        
        .name-field {
            border-bottom: 1px dotted #2c5282;
            min-height: 1.5rem;
        }
        
        .day-page, .gate-page {
            display: none;
        }
        
        .day-page.active, .gate-page.active {
            display: block;
        }
        
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.25rem 0.25rem 0 0;
            font-weight: 500;
        }
        
        .tab-button.active {
            background-color: #fff;
            border-bottom: 2px solid #3b82f6;
        }
        
        .signature-area {
            display: flex;
            justify-content: center;
            gap: 2cm;
        }
        
        .signature-line {
            border-bottom: 1px dotted #2c5282;
            display: inline-block;
            min-width: 200px;
            text-align: center;
        }
        
        /* Increase name column width */
        .duty-table .name-column {
            min-width: 250px; /* Increased from default */
            width: 30%; /* Make it take up more space proportionally */
        }
        
        .duty-table .class-column {
            width: 8%;
        }
        
        .duty-table .status-column {
            width: 5%;
        }
        
        .duty-table .note-column {
            width: 15%;
        }
        
        .stats-container {
            background-color: #f8fafc;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }
        
        .stat-item {
            padding: 0.5rem;
            border-radius: 0.25rem;
            text-align: center;
        }
        
        .present-stat {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .leave-stat {
            background-color: #fef9c3;
            color: #854d0e;
        }
        
        .late-stat {
            background-color: #ffedd5;
            color: #9a3412;
        }
        
        .absent-stat {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-complete {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .status-incomplete {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        
        .student-list-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .student-list-table th,
        .student-list-table td {
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
        }
        
        .student-list-table th {
            background-color: #f1f5f9;
            font-weight: 600;
        }
        
        .student-list-table tr:nth-child(even) {
            background-color: #f8fafc;
        }
        
        .delete-btn {
            background-color: #ef4444;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .delete-btn:hover {
            background-color: #dc2626;
        }
        
        .data-management {
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .data-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .data-item:last-child {
            border-bottom: none;
        }
        
        .view-sheet-btn {
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.25rem;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .view-sheet-btn:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body class="p-4">
    <!-- Navigation Controls -->
    <div class="no-print bg-blue-100 p-4 mb-4 rounded-lg shadow">
        <div class="flex flex-wrap gap-4 justify-between items-center">
            <div class="flex gap-2">
                <button id="prev-day" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    ‚óÄ ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                </button>
                <button id="next-day" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    ‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂
                </button>
            </div>
            <div>
                <label class="font-semibold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: </label>
                <input type="date" id="date-picker" class="border border-blue-300 rounded px-2 py-1">
            </div>
            <div>
                <button id="save-btn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
        
        <div class="mt-4 flex flex-wrap gap-2">
            <span class="font-semibold">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô: </span>
            <button class="day-nav px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="1">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</button>
            <button class="day-nav px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="2">‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</button>
            <button class="day-nav px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="3">‡∏û‡∏∏‡∏ò</button>
            <button class="day-nav px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="4">‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</button>
            <button class="day-nav px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="5">‡∏®‡∏∏‡∏Å‡∏£‡πå</button>
        </div>
        
        <div class="mt-4 flex gap-2">
            <span class="font-semibold">‡∏à‡∏∏‡∏î‡πÄ‡∏ß‡∏£: </span>
            <button class="gate-nav px-3 py-1 bg-blue-200 rounded hover:bg-blue-300 active" data-gate="1">‡∏õ‡∏£‡∏∞‡∏ï‡∏π 1</button>
            <button class="gate-nav px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-gate="2">‡∏õ‡∏£‡∏∞‡∏ï‡∏π 2</button>
        </div>
        
        <div class="mt-4 flex gap-2">
            <button id="show-student-list" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
                üë• ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
            <button id="manage-data-btn" class="px-3 py-1 bg-purple-500 text-white rounded hover:bg-purple-600">
                üóÑÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
            <button id="print-btn" class="px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600">
                üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå
            </button>
            <button id="view-sheet-btn" class="view-sheet-btn">
                üìä ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheet
            </button>
        </div>
    </div>
    
    <!-- Student List Modal -->
    <div id="student-list-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-auto">
        <div class="bg-white max-w-4xl mx-auto my-10 p-6 rounded-lg shadow-xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ß‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <button id="close-student-list" class="text-2xl">&times;</button>
            </div>
            
            <div class="mb-4">
                <div class="flex gap-2 mb-2">
                    <button class="day-filter px-3 py-1 bg-blue-200 rounded hover:bg-blue-300 active" data-day="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button class="day-filter px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="1">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</button>
                    <button class="day-filter px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="2">‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</button>
                    <button class="day-filter px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="3">‡∏û‡∏∏‡∏ò</button>
                    <button class="day-filter px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="4">‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</button>
                    <button class="day-filter px-3 py-1 bg-blue-200 rounded hover:bg-blue-300" data-day="5">‡∏®‡∏∏‡∏Å‡∏£‡πå</button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="student-list-table">
                    <thead>
                        <tr>
                            <th>‡∏ß‡∏±‡∏ô</th>
                            <th>‡∏à‡∏∏‡∏î‡πÄ‡∏ß‡∏£</th>
                            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                            <th>‡∏ä‡∏±‡πâ‡∏ô</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody id="student-list-body">
                        <!-- Student list will be generated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Data Management Modal -->
    <div id="data-management-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-auto">
        <div class="bg-white max-w-4xl mx-auto my-10 p-6 rounded-lg shadow-xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                <button id="close-data-management" class="text-2xl">&times;</button>
            </div>
            
            <div class="mb-4">
                <p class="text-gray-600">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
            </div>
            
            <div class="data-list" id="data-list">
                <!-- Data items will be generated here -->
            </div>
            
            <div class="mt-4 flex justify-between">
                <button id="delete-all-data" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                    ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button id="refresh-data-list" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </button>
            </div>
        </div>
    </div>
    
    <!-- Day and Gate pages container -->
    <div id="day-pages-container">
        <!-- Day and Gate pages will be generated here -->
    </div>

    <script>
        // Thai day names
        const thaiDayNames = [
            "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå"
        ];
        
        // Gate names
        const gateNames = ["‡∏õ‡∏£‡∏∞‡∏ï‡∏π 1", "‡∏õ‡∏£‡∏∞‡∏ï‡∏π 2"];
        
        // Duty head names for each day and gate
        const dutyHeads = {
            1: { // Monday
                1: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏ô‡∏±‡∏ô‡∏ó‡πå‡∏ô‡∏†‡∏±‡∏™ ‡∏û‡∏£‡∏°‡∏ß‡∏±‡∏á",
                2: "‡∏ô‡∏®‡∏ó.‡∏ò‡∏ô‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå"
            },
            2: { // Tuesday
                1: "‡∏ô‡∏®‡∏ó.‡∏ì‡∏ê‡∏Å‡∏£ ‡∏Å‡∏£‡∏°‡∏î‡∏µ",
                2: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏™‡∏∏‡∏ä‡∏≤‡∏°‡∏∞‡∏£‡∏µ ‡∏û‡∏•‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥"
            },
            3: { // Wednesday
                1: "‡∏ô‡∏®‡∏ó.‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏• ‡∏û‡∏¥‡∏°‡∏Ñ‡∏≥‡πÑ‡∏´‡∏•",
                2: "‡∏ô‡∏®‡∏ó.‡∏®‡∏∏‡∏†‡∏§‡∏Å‡∏©‡πå ‡∏™‡∏∏‡πÇ‡∏û‡πÑ‡∏Ç"
            },
            4: { // Thursday
                1: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏ü‡πâ‡∏≤‡∏£‡∏∏‡πà‡∏á ‡∏õ‡∏±‡πâ‡∏ô‡∏ä‡∏≤‡∏ß‡∏ô‡∏≤",
                2: "‡∏ô‡∏®‡∏ó.‡∏ô‡∏û‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏™‡∏£‡∏ì‡πå"
            },
            5: { // Friday
                1: "‡∏ô‡∏®‡∏ó.‡∏™‡∏∏‡∏£‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏°‡∏ö‡∏£‡∏π‡∏ì‡πå",
                2: "‡∏ô‡∏®‡∏ó.‡∏õ‡∏è‡∏¥‡∏†‡∏≤‡∏ì ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ô‡∏≤‡∏Ñ"
            }
        };
        
        // Student data for each day and gate
        const studentData = {
            1: { // Monday
                1: [ // Gate 1
                    {name: "‡∏ô‡∏®‡∏ó.‡∏û‡∏µ‡∏£‡∏ß‡∏¥‡∏ä‡∏ç‡πå ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏´‡∏≠‡∏°", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ä‡∏±‡∏¢‡∏°‡∏á‡∏Ñ‡∏• ‡∏°‡∏±‡∏á‡∏ï‡∏≤", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏ô‡∏ï‡πå ‡πÑ‡∏Å‡∏£‡∏¢‡∏∞‡∏ß‡∏á‡∏®‡πå", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏ô‡∏±‡∏ô‡∏ó‡πå‡∏ô‡∏†‡∏±‡∏™ ‡∏û‡∏£‡∏°‡∏ß‡∏±‡∏á", classYear: "‡∏õ‡∏µ 3"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏û‡∏±‡∏ä‡∏£‡∏≤‡∏û‡∏£ ‡∏â‡∏•‡∏µ", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏ô‡∏•‡∏¥‡∏ô‡∏µ ‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏¥‡∏°", classYear: "‡∏õ‡∏µ 1"}
                ],
                2: [ // Gate 2
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ò‡∏ô‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏™‡∏≤‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå", classYear: "‡∏õ‡∏µ 3"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏®‡∏∏‡∏†‡∏Å‡∏£ ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ö‡∏∏‡∏ç‡∏°‡∏µ", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏û‡∏ä‡∏£ ‡∏™‡∏∏‡∏ï‡πâ‡∏ô", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏ì‡∏±‡∏ä‡∏ä‡∏≤ ‡∏´‡∏•‡∏ß‡∏á‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏≠‡∏£‡∏¥‡∏™‡∏£‡∏≤ ‡∏†‡∏π‡∏ó‡∏≠‡∏á‡πÅ‡∏ó‡πâ", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ ‡πÅ‡∏Å‡πâ‡∏ß‡πÄ‡∏Å‡∏¥‡∏î", classYear: "‡∏õ‡∏µ 1"}
                ]
            },
            2: { // Tuesday
                1: [ // Gate 1
                    {name: "‡∏ô‡∏®‡∏ó.‡∏à‡∏¥‡∏ï‡∏ï‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏ä‡∏π‡∏ä‡∏ô‡∏∞", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ì‡∏ê‡∏Å‡∏£ ‡∏Å‡∏£‡∏°‡∏î‡∏µ", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ä‡∏≤‡∏ç‡∏¢‡∏∏‡∏ó‡∏ò ‡∏™‡∏µ‡∏´‡∏≤‡∏ö‡∏á", classYear: "‡∏õ‡∏µ 3"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏†‡∏π‡∏ß‡∏î‡∏• ‡∏Ç‡πâ‡∏≠‡∏¢‡∏∏‡πà‡∏ô", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡πÄ‡∏°‡∏ó‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏ó‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏ï", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏™‡∏∏‡∏Å‡∏±‡∏ç‡∏ç‡∏≤ ‡∏Å‡∏≠‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå", classYear: "‡∏õ‡∏µ 1"}
                ],
                2: [ // Gate 2
                    {name: "‡∏ô‡∏®‡∏ó.‡∏û‡∏±‡∏£‡∏ô‡∏±‡∏ê ‡∏Ñ‡∏≥‡∏ö‡∏∂‡∏á‡∏Å‡∏•‡∏≤‡∏á", classYear: "‡∏õ‡∏µ 3"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏Ç‡∏ß‡∏±‡∏ç‡∏à‡∏¥‡∏£‡∏≤ ‡πÄ‡∏Æ‡πâ‡∏≤‡∏ï‡∏∏‡πà‡∏ô", classYear: "‡∏õ‡∏µ 3"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏†‡∏µ‡∏û‡∏±‡∏ï‡∏£ ‡∏ô‡∏û‡∏ß‡∏±‡∏í‡∏ô‡πå", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏™‡∏¥‡∏ó‡∏ò‡∏ß‡∏µ‡∏£‡πå ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏•‡∏µ", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏™‡∏∏‡∏ä‡∏≤‡∏°‡∏∞‡∏£‡∏µ ‡∏û‡∏•‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ä‡∏≤‡∏ô‡∏ô‡∏ó‡πå ‡πÇ‡∏Ñ‡∏ï‡∏∞‡∏°‡∏µ", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ß‡∏∏‡∏í‡∏¥‡∏†‡∏±‡∏ó‡∏£ ‡∏°‡∏∞‡∏´‡∏±‡∏ô‡∏ï‡πå", classYear: "‡∏õ‡∏µ 1"}
                ]
            },
            3: { // Wednesday
                1: [ // Gate 1
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ì‡∏±‡∏ê‡∏Å‡∏£‡∏ì‡πå ‡∏ö‡∏∏‡∏ç‡∏ó‡∏µ", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏†‡∏π‡∏û‡∏¥‡∏£‡∏±‡∏ê ‡∏ß‡∏á‡∏©‡πå‡πÉ‡∏´‡∏ç‡πà", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ò‡∏ô‡∏Å‡∏£‡∏ì‡πå ‡∏ò‡∏£‡∏£‡∏°‡∏ò‡∏£", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏†‡∏±‡∏ó‡∏£‡∏û‡∏• ‡∏û‡∏¥‡∏°‡∏Ñ‡∏≥‡πÑ‡∏´‡∏•", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏ò‡∏¥‡∏î‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏ß‡∏£‡∏£‡∏ì‡∏ó‡∏ß‡∏µ", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡πÄ‡∏õ‡∏£‡∏°‡∏°‡∏¥‡∏Å‡∏≤ ‡∏û‡∏•‡∏ã‡πâ‡∏≤‡∏¢", classYear: "‡∏õ‡∏µ 2"}
                ],
                2: [ // Gate 2
                    {name: "‡∏ô‡∏®‡∏ó.‡∏®‡∏∏‡∏†‡∏§‡∏Å‡∏©‡πå ‡∏™‡∏∏‡πÇ‡∏û‡πÑ‡∏Ç", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏à‡∏µ‡∏£‡∏∞‡πÄ‡∏î‡∏ä ‡∏ô‡∏±‡∏ô‡∏ó‡πÄ‡∏û‡∏£‡∏ä", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏õ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡∏™‡∏∏‡πà‡∏°‡∏°‡∏≤‡∏ï‡∏£", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏≠‡∏†‡∏¥‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡∏™‡∏¥‡∏°‡∏•‡∏µ", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏£ ‡∏≠‡∏¥‡∏ô‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏û‡∏±‡∏ó‡∏£ ‡πÇ‡∏ï‡∏™‡∏π‡∏á‡πÄ‡∏ô‡∏¥‡∏ô", classYear: "‡∏õ‡∏µ 3"}
                ]
            },
            4: { // Thursday
                1: [ // Gate 1
                    {name: "‡∏ô‡∏®‡∏ó.‡∏£‡∏±‡∏ê‡∏†‡∏π‡∏°‡∏¥ ‡πÑ‡∏ä‡∏¢‡∏®‡∏£‡∏µ", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ü‡πâ‡∏≤‡∏£‡∏∏‡πà‡∏á ‡∏õ‡∏±‡πâ‡∏ô‡∏ä‡∏≤‡∏ß‡∏ô‡∏≤", classYear: "‡∏õ‡∏µ 3"},
                    {name: "‡∏ô‡∏®‡∏ó.‡πÄ‡∏à‡∏©‡∏é‡∏≤‡∏Å‡∏£ ‡∏°‡∏´‡∏≤‡∏´‡∏¥‡∏á‡∏®‡πå", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏®‡∏¥‡∏£‡∏û‡∏±‡∏ä‡∏®‡∏£ ‡∏ö‡∏∏‡∏ç‡∏°‡∏µ", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ß‡∏£‡πÄ‡∏°‡∏ó ‡∏ú‡πà‡∏≤‡∏ô‡∏ß‡∏á‡∏©‡πå", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏û‡∏£‡∏°‡∏û‡∏¥‡∏£‡∏¥‡∏¢‡∏∞ ‡∏ö‡∏∏‡∏£‡∏°‡∏®‡∏£‡∏µ", classYear: "‡∏õ‡∏µ 1"}
                ],
                2: [ // Gate 2
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ô‡∏û‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏™‡∏£‡∏ì‡πå", classYear: "‡∏õ‡∏µ 3"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ò‡∏ô‡∏≤‡∏Å‡∏£ ‡∏ä‡∏≤‡∏ç‡∏õ‡∏£‡∏∞‡πÑ‡∏û", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏¢‡∏∏‡∏ó‡∏ò‡∏û‡∏• ‡∏™‡∏∏‡∏Ç‡∏™‡πà‡∏á", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏®‡∏∏‡∏†‡∏ì‡∏±‡∏ê ‡∏à‡∏±‡∏ô‡∏ó‡∏•‡∏µ", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ß‡∏µ‡∏£‡∏†‡∏±‡∏ó‡∏£ ‡πÅ‡∏Å‡πâ‡∏ß‡∏•‡∏∑‡∏°‡∏ä‡∏±‡∏¢", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡∏ß‡∏¥‡∏ä‡∏¥‡∏î‡∏≤ ‡πÄ‡∏ä‡∏≤‡∏ß‡πå‡∏î‡∏µ", classYear: "‡∏õ‡∏µ 1"}
                ]
            },
            5: { // Friday
                1: [ // Gate 1
                    {name: "‡∏ô‡∏®‡∏ó.‡∏™‡∏¥‡∏£‡∏†‡∏û ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡∏Å", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ß‡∏£‡∏≤‡∏Å‡∏£ ‡πÑ‡∏ä‡∏¢‡∏´‡∏≤‡∏ô‡∏≤‡∏°", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏™‡∏∏‡∏£‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ç.‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡∏£‡∏≥‡πÑ‡∏û ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏£‡∏±‡∏°‡∏¢‡πå", classYear: "‡∏õ‡∏µ 3"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏î‡∏≠‡∏Å‡∏à‡∏≠‡∏Å", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ì‡∏±‡∏ê‡∏ä‡∏ô‡∏ô ‡∏≠‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÑ‡∏û", classYear: "‡∏õ‡∏µ 1"}
                ],
                2: [ // Gate 2
                    {name: "‡∏ô‡∏®‡∏ó.‡∏õ‡∏è‡∏¥‡∏†‡∏≤‡∏ì ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ô‡∏≤‡∏Ñ", classYear: "‡∏õ‡∏µ 3"},
                    {name: "‡∏ô‡∏®‡∏ó.‡πÄ‡∏õ‡∏£‡∏°‡∏™‡∏ô‡∏µ ‡∏Ç‡∏≠‡∏ü‡∏∏‡πâ‡∏á‡∏Å‡∏•‡∏≤‡∏á", classYear: "‡∏õ‡∏µ 1"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏ò‡∏µ‡∏£‡∏ô‡∏±‡∏ê ‡πÇ‡∏Ñ‡∏£‡∏ï‡∏ä‡∏∏‡∏°", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏â‡∏±‡∏à‡∏£‡πÅ‡∏Å‡πâ‡∏ß ‡∏û‡∏¢‡∏±‡∏Ñ‡∏Ü‡πÄ‡∏î‡∏ä", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏Å‡∏∏‡∏•‡∏ó‡∏≠‡∏á", classYear: "‡∏õ‡∏µ 2"},
                    {name: "‡∏ô‡∏®‡∏ó.‡∏™‡∏¥‡∏ó‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏Å‡∏¥‡∏ï‡∏¥‡∏°‡∏≤", classYear: "‡∏õ‡∏µ 1"}
                ]
            }
        };
        
        // Status types
        const statusTypes = ['‡∏°‡∏≤', '‡∏•‡∏≤', '‡∏™‡∏≤‡∏¢', '‡∏Ç‡∏≤‡∏î'];
        const statusLabels = {
            '‡∏°‡∏≤': '‚úÖ ‡∏°‡∏≤',
            '‡∏•‡∏≤': 'üìë ‡∏•‡∏≤',
            '‡∏™‡∏≤‡∏¢': '‚è∞ ‡∏™‡∏≤‡∏¢',
            '‡∏Ç‡∏≤‡∏î': '‚ùå ‡∏Ç‡∏≤‡∏î'
        };
        
        // Google Apps Script URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzW3rfkxbqSzVLtaROIB6yK2rbg_zcidNvTpI-6hIaPXV8-5CPrEwKilUAsNCLNNVK_yQ/exec';
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1C8xjL8AluYkJjqe9JbTlNoWzAX1axfzCyMlihSAbOgc/edit?gid=0#gid=0';
        
        // Get the Monday of the current week
        function getMonday(d) {
            d = new Date(d);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // adjust when day is Sunday
            return new Date(d.setDate(diff));
        }
        
        // Format date as Thai format
        function formatThaiDate(date) {
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear() + 543; // Convert to Buddhist Era
            return `${day}/${month}/${year}`;
        }
        
        // Get dates for the week (Monday to Friday)
        function getWeekDates(mondayDate) {
            const dates = [];
            for (let i = 0; i < 5; i++) { // Monday to Friday
                const date = new Date(mondayDate);
                date.setDate(date.getDate() + i);
                dates.push(date);
            }
            return dates;
        }
        
        // Initialize with current week's Monday
        let currentDate = new Date();
        let mondayDate = getMonday(currentDate);
        let weekDates = getWeekDates(mondayDate);
        let activeDay = currentDate.getDay();
        let activeGate = 1; // Default to Gate 1
        
        // If weekend, set active day to Monday
        if (activeDay === 0 || activeDay === 6) {
            activeDay = 1;
            currentDate = new Date(mondayDate);
        }
        
        // Store attendance data
        let attendanceData = {};
        
        // Load data from localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('attendanceData');
            if (savedData) {
                try {
                    attendanceData = JSON.parse(savedData);
                } catch (e) {
                    console.error("Error loading data from localStorage:", e);
                    attendanceData = {};
                }
            }
        }
        
        // Save data to localStorage
        function saveToLocalStorage() {
            try {
                localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
                return true;
            } catch (e) {
                console.error("Error saving data to localStorage:", e);
                return false;
            }
        }
        
        // Send data to Google Sheets using JSONP
        function sendToGoogleSheets(data) {
            return new Promise((resolve, reject) => {
                // Create a unique callback name
                const callbackName = 'jsonpCallback_' + Date.now();
                
                // Create the callback function
                window[callbackName] = function(response) {
                    // Clean up by removing the script tag
                    document.body.removeChild(script);
                    // Remove the global callback function
                    delete window[callbackName];
                    
                    if (response.result === 'success') {
                        resolve(response);
                    } else {
                        reject(response);
                    }
                };
                
                // Prepare data for URL
                const jsonData = encodeURIComponent(JSON.stringify(data));
                
                // Create script tag
                const script = document.createElement('script');
                script.src = `${SCRIPT_URL}?data=${jsonData}&callback=${callbackName}`;
                
                // Handle errors
                script.onerror = function() {
                    // Clean up
                    document.body.removeChild(script);
                    delete window[callbackName];
                    reject(new Error('Script loading failed'));
                };
                
                // Add script to document to start the request
                document.body.appendChild(script);
            });
        }
        
        // Calculate statistics for a day and gate
        function calculateStats(dayOfWeek, gateNumber) {
            const dateKey = formatThaiDate(weekDates[dayOfWeek - 1]);
            const key = `${dateKey}-${gateNumber}`;
            
            if (!attendanceData[key]) {
                return {
                    morning: { ‡∏°‡∏≤: 0, ‡∏•‡∏≤: 0, ‡∏™‡∏≤‡∏¢: 0, ‡∏Ç‡∏≤‡∏î: 0, ‡∏£‡∏ß‡∏°: 0 },
                    evening: { ‡∏°‡∏≤: 0, ‡∏•‡∏≤: 0, ‡∏™‡∏≤‡∏¢: 0, ‡∏Ç‡∏≤‡∏î: 0, ‡∏£‡∏ß‡∏°: 0 },
                    complete: false
                };
            }
            
            const stats = {
                morning: { ‡∏°‡∏≤: 0, ‡∏•‡∏≤: 0, ‡∏™‡∏≤‡∏¢: 0, ‡∏Ç‡∏≤‡∏î: 0, ‡∏£‡∏ß‡∏°: 0 },
                evening: { ‡∏°‡∏≤: 0, ‡∏•‡∏≤: 0, ‡∏™‡∏≤‡∏¢: 0, ‡∏Ç‡∏≤‡∏î: 0, ‡∏£‡∏ß‡∏°: 0 },
                complete: true
            };
            
            const students = studentData[dayOfWeek] && studentData[dayOfWeek][gateNumber] 
                ? studentData[dayOfWeek][gateNumber] 
                : [];
            const totalStudents = students.length;
            
            // Count each status
            Object.values(attendanceData[key]).forEach(student => {
                if (typeof student !== 'object' || student === null) return;
                
                if (student.morning) {
                    stats.morning[student.morning]++;
                    stats.morning.total++;
                }
                
                if (student.evening) {
                    stats.evening[student.evening]++;
                    stats.evening.total++;
                }
            });
            
            // Check if all students have been marked for both periods
            stats.complete = (stats.morning.total === totalStudents && stats.evening.total === totalStudents);
            
            return stats;
        }
        
        // Create day and gate pages
        function createDayGatePages() {
            const container = document.getElementById('day-pages-container');
            container.innerHTML = '';
            
            weekDates.forEach((date, dayIndex) => {
                const dayOfWeek = date.getDay();
                
                // For each gate
                gateNames.forEach((gateName, gateIndex) => {
                    const gateNumber = gateIndex + 1;
                    const isActive = dayOfWeek === activeDay && gateNumber === activeGate;
                    
                    // Get duty head for this day and gate
                    const dutyHead = dutyHeads[dayOfWeek] && dutyHeads[dayOfWeek][gateNumber] 
                        ? dutyHeads[dayOfWeek][gateNumber] 
                        : "";
                    
                    // Calculate statistics
                    const stats = calculateStats(dayOfWeek, gateNumber);
                    
                    // Create day-gate page
                    const dayGatePage = document.createElement('div');
                    dayGatePage.className = `day-page gate-page print-container max-w-7xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden ${isActive ? 'active' : ''}`;
                    dayGatePage.id = `day-${dayOfWeek}-gate-${gateNumber}`;
                    dayGatePage.setAttribute('data-date', formatThaiDate(date));
                    dayGatePage.setAttribute('data-gate', gateName);
                    dayGatePage.setAttribute('data-day', dayOfWeek);
                    dayGatePage.setAttribute('data-gate-number', gateNumber);
                    
                    // Create page content
                    dayGatePage.innerHTML = `
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4">
                            <h1 class="text-2xl font-bold text-center">‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏£ ‡∏ô‡∏®‡∏ó.‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏±‡∏ï‡∏ô‡πå‡∏û‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏° ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 2568</h1>
                            <div class="flex justify-between mt-2">
                                <div>
                                    <span class="font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: </span>
                                    <span>${formatThaiDate(date)}</span>
                                </div>
                                <div>
                                    <span class="font-semibold">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô: </span>
                                    <span>‡∏ß‡∏±‡∏ô${thaiDayNames[dayOfWeek]}</span>
                                </div>
                                <div>
                                    <span class="font-semibold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: </span>
                                    <span class="status-badge ${stats.complete ? 'status-complete' : 'status-incomplete'}">
                                        ${stats.complete ? '‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏£‡∏ö' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö'}
                                    </span>
                                </div>
                            </div>
                            <div class="mt-2">
                                <span class="font-semibold">‡∏à‡∏∏‡∏î‡πÄ‡∏ß‡∏£: </span>
                                <span>${gateName}</span>
                            </div>
                        </div>
                        
                        <!-- Statistics -->
                        <div class="p-4">
                            <div class="stats-container">
                                <h3 class="text-lg font-semibold mb-2">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£</h3>
                                
                                <div class="mb-3">
                                    <h4 class="font-medium">‡πÄ‡∏ß‡∏£‡πÄ‡∏ä‡πâ‡∏≤</h4>
                                    <div class="stats-grid">
                                        <div class="stat-item ‡∏°‡∏≤-stat">
                                            <div class="text-lg font-bold">${stats.morning.‡∏°‡∏≤}</div>
                                            <div>‚úÖ ‡∏°‡∏≤</div>
                                        </div>
                                        <div class="stat-item ‡∏•‡∏≤-stat">
                                            <div class="text-lg font-bold">${stats.morning.‡∏•‡∏≤}</div>
                                            <div>üìë ‡∏•‡∏≤</div>
                                        </div>
                                        <div class="stat-item ‡∏™‡∏≤‡∏¢-stat">
                                            <div class="text-lg font-bold">${stats.morning.‡∏™‡∏≤‡∏¢}</div>
                                            <div>‚è∞ ‡∏™‡∏≤‡∏¢</div>
                                        </div>
                                        <div class="stat-item ‡∏Ç‡∏≤‡∏î-stat">
                                            <div class="text-lg font-bold">${stats.morning.‡∏Ç‡∏≤‡∏î}</div>
                                            <div>‚ùå ‡∏Ç‡∏≤‡∏î</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-medium">‡πÄ‡∏ß‡∏£‡πÄ‡∏¢‡πá‡∏ô</h4>
                                    <div class="stats-grid">
                                        <div class="stat-item ‡∏°‡∏≤-stat">
                                            <div class="text-lg font-bold">${stats.evening.‡∏°‡∏≤}</div>
                                            <div>‚úÖ ‡∏°‡∏≤</div>
                                        </div>
                                        <div class="stat-item ‡∏•‡∏≤-stat">
                                            <div class="text-lg font-bold">${stats.evening.‡∏•‡∏≤}</div>
                                            <div>üìë ‡∏•‡∏≤</div>
                                        </div>
                                        <div class="stat-item ‡∏™‡∏≤‡∏¢-stat">
                                            <div class="text-lg font-bold">${stats.evening.‡∏™‡∏≤‡∏¢}</div>
                                            <div>‚è∞ ‡∏™‡∏≤‡∏¢</div>
                                        </div>
                                        <div class="stat-item ‡∏Ç‡∏≤‡∏î-stat">
                                            <div class="text-lg font-bold">${stats.evening.‡∏Ç‡∏≤‡∏î}</div>
                                            <div>‚ùå ‡∏Ç‡∏≤‡∏î</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <!-- Table Container -->
                            <div class="overflow-x-auto">
                                <table class="duty-table w-full text-sm">
                                    <thead>
                                        <tr class="bg-blue-700 text-white">
                                            <th rowspan="3" class="px-2 py-1 text-center" style="width: 5%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                            <th rowspan="3" class="px-2 py-1 text-center name-column">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                            <th rowspan="3" class="px-2 py-1 text-center class-column">‡∏ä‡∏±‡πâ‡∏ô</th>
                                            <th colspan="8" class="px-2 py-1 text-center">‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</th>
                                            <th rowspan="3" class="px-2 py-1 text-center note-column">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                        </tr>
                                        <tr class="bg-blue-600 text-white">
                                            <th colspan="4" class="px-2 py-1 text-center">‡πÄ‡∏ß‡∏£‡πÄ‡∏ä‡πâ‡∏≤</th>
                                            <th colspan="4" class="px-2 py-1 text-center">‡πÄ‡∏ß‡∏£‡πÄ‡∏¢‡πá‡∏ô</th>
                                        </tr>
                                        <tr class="bg-blue-500 text-white">
                                            <th class="px-2 py-1 text-center bg-green-600 status-column">‡∏°‡∏≤</th>
                                            <th class="px-2 py-1 text-center bg-yellow-600 status-column">‡∏•‡∏≤</th>
                                            <th class="px-2 py-1 text-center bg-orange-600 status-column">‡∏™‡∏≤‡∏¢</th>
                                            <th class="px-2 py-1 text-center bg-red-600 status-column">‡∏Ç‡∏≤‡∏î</th>
                                            <th class="px-2 py-1 text-center bg-green-600 status-column">‡∏°‡∏≤</th>
                                            <th class="px-2 py-1 text-center bg-yellow-600 status-column">‡∏•‡∏≤</th>
                                            <th class="px-2 py-1 text-center bg-orange-600 status-column">‡∏™‡∏≤‡∏¢</th>
                                            <th class="px-2 py-1 text-center bg-red-600 status-column">‡∏Ç‡∏≤‡∏î</th>
                                        </tr>
                                    </thead>
                                    <tbody class="duty-roster">
                                        ${generateStudentRows(dayOfWeek, gateNumber)}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Signature area with duty head and teacher -->
                            <div class="mt-8 signature-area">
                                <!-- Duty head -->
                                <div class="text-center">
                                    <div class="mb-16">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ <span class="signature-line">&nbsp;</span></div>
                                    <div>(<span class="signature-line name-field">
                                        <input type="text" class="w-full border-0 bg-transparent focus:outline-none focus:ring-1 focus:ring-blue-500 rounded text-center duty-head-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•..." value="${dutyHead}">
                                    </span>)</div>
                                    <div>‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡∏£</div>
                                </div>
                                
                                <!-- Teacher signature -->
                                <div class="text-center">
                                    <div class="mb-16">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ <span class="signature-line">&nbsp;</span></div>
                                    <div>(<span class="signature-line name-field">
                                        <input type="text" class="w-full border-0 bg-transparent focus:outline-none focus:ring-1 focus:ring-blue-500 rounded text-center teacher-input" value="‡∏ô‡∏≤‡∏¢ ‡∏ì‡∏†‡∏±‡∏ó‡∏£ ‡∏ä‡∏ô‡∏∞‡πÇ‡∏¢‡∏ò‡∏≤">
                                    </span>)</div>
                                    <div>‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ß‡∏£</div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(dayGatePage);
                    
                    // Add event listeners to checkboxes
                    const checkboxes = dayGatePage.querySelectorAll('.checkbox');
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('click', function() {
                            const row = this.closest('tr');
                            const rowNum = row.getAttribute('data-row');
                            const checkboxIndex = Array.from(row.querySelectorAll('.checkbox')).indexOf(this);
                            const isInMorningGroup = checkboxIndex < 4;
                            const statusType = this.getAttribute('data-status');
                            const period = isInMorningGroup ? 'morning' : 'evening';
                            
                            // Clear all checkboxes in the same row and group
                            const groupCheckboxes = isInMorningGroup ? 
                                row.querySelectorAll('td:nth-child(n+4):nth-child(-n+7) .checkbox') : 
                                row.querySelectorAll('td:nth-child(n+8):nth-child(-n+11) .checkbox');
                            
                            groupCheckboxes.forEach(cb => {
                                cb.classList.remove('present', 'leave', 'late', 'absent');
                            });
                            
                            // Check this checkbox
                            this.classList.add(statusType);
                            
                            // Update attendance data
                            const dateKey = formatThaiDate(date);
                            const key = `${dateKey}-${gateNumber}`;
                            
                            if (!attendanceData[key]) {
                                attendanceData[key] = {};
                            }
                            
                            if (!attendanceData[key][rowNum]) {
                                attendanceData[key][rowNum] = {
                                    name: row.querySelector('td:nth-child(2) input').value,
                                    classYear: row.querySelector('td:nth-child(3) input').value,
                                    note: row.querySelector('td:last-child input').value
                                };
                            }
                            
                            attendanceData[key][rowNum][period] = statusType;
                            
                            // Save to localStorage
                            saveToLocalStorage();
                            
                            // Update statistics
                            updatePageStatistics(dayGatePage, dayOfWeek, gateNumber);
                        });
                    });
                    
                    // Add event listeners to input fields
                    const inputs = dayGatePage.querySelectorAll('input[type="text"]');
                    inputs.forEach(input => {
                        input.addEventListener('change', function() {
                            const row = this.closest('tr');
                            if (row) {
                                const rowNum = row.getAttribute('data-row');
                                const dateKey = formatThaiDate(date);
                                const key = `${dateKey}-${gateNumber}`;
                                
                                if (!attendanceData[key]) {
                                    attendanceData[key] = {};
                                }
                                
                                if (!attendanceData[key][rowNum]) {
                                    attendanceData[key][rowNum] = {};
                                }
                                
                                const nameInput = row.querySelector('td:nth-child(2) input');
                                const classInput = row.querySelector('td:nth-child(3) input');
                                const noteInput = row.querySelector('td:last-child input');
                                
                                attendanceData[key][rowNum].name = nameInput.value;
                                attendanceData[key][rowNum].classYear = classInput.value;
                                attendanceData[key][rowNum].note = noteInput.value;
                                
                                // Save to localStorage
                                saveToLocalStorage();
                            }
                        });
                    });
                    
                    // Add event listeners to duty head and teacher inputs
                    const dutyHeadInput = dayGatePage.querySelector('.duty-head-input');
                    const teacherInput = dayGatePage.querySelector('.teacher-input');
                    
                    dutyHeadInput.addEventListener('change', function() {
                        const dateKey = formatThaiDate(date);
                        const key = `${dateKey}-${gateNumber}`;
                        
                        if (!attendanceData[key]) {
                            attendanceData[key] = {};
                        }
                        
                        attendanceData[key].dutyHead = this.value;
                        saveToLocalStorage();
                    });
                    
                    teacherInput.addEventListener('change', function() {
                        const dateKey = formatThaiDate(date);
                        const key = `${dateKey}-${gateNumber}`;
                        
                        if (!attendanceData[key]) {
                            attendanceData[key] = {};
                        }
                        
                        attendanceData[key].teacher = this.value;
                        saveToLocalStorage();
                    });
                    
                    // Load duty head and teacher from saved data
                    const dateKey = formatThaiDate(date);
                    const key = `${dateKey}-${gateNumber}`;
                    if (attendanceData[key]) {
                        if (attendanceData[key].dutyHead) {
                            dutyHeadInput.value = attendanceData[key].dutyHead;
                        }
                        
                        if (attendanceData[key].teacher) {
                            teacherInput.value = attendanceData[key].teacher;
                        }
                    }
                });
            });
        }
        
        // Update statistics on a page
        function updatePageStatistics(page, dayOfWeek, gateNumber) {
            const stats = calculateStats(dayOfWeek, gateNumber);
            
            // Update status badge
            const statusBadge = page.querySelector('.status-badge');
            if (stats.complete) {
                statusBadge.textContent = '‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏£‡∏ö';
                statusBadge.classList.remove('status-incomplete');
                statusBadge.classList.add('status-complete');
            } else {
                statusBadge.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö';
                statusBadge.classList.remove('status-complete');
                statusBadge.classList.add('status-incomplete');
            }
            
            // Update morning stats
            const morningStats = page.querySelectorAll('.stats-grid:first-of-type .stat-item .text-lg');
            morningStats[0].textContent = stats.morning.present;
            morningStats[1].textContent = stats.morning.leave;
            morningStats[2].textContent = stats.morning.late;
            morningStats[3].textContent = stats.morning.absent;
            
            // Update evening stats
            const eveningStats = page.querySelectorAll('.stats-grid:last-of-type .stat-item .text-lg');
            eveningStats[0].textContent = stats.evening.present;
            eveningStats[1].textContent = stats.evening.leave;
            eveningStats[2].textContent = stats.evening.late;
            eveningStats[3].textContent = stats.evening.absent;
        }
        
        // Generate student rows HTML
        function generateStudentRows(dayOfWeek, gateNumber) {
            let rowsHTML = '';
            
            // Get students for this day and gate
            const students = studentData[dayOfWeek] && studentData[dayOfWeek][gateNumber] 
                ? studentData[dayOfWeek][gateNumber] 
                : [];
            
            // Get attendance data for this day and gate
            const dateKey = formatThaiDate(weekDates[dayOfWeek - 1]);
            const key = `${dateKey}-${gateNumber}`;
            const dayAttendance = attendanceData[key] || {};
            
            // Generate rows for each student
            students.forEach((student, index) => {
                const rowNum = index + 1;
                const bgClass = rowNum % 2 === 0 ? 'bg-blue-50' : 'bg-white';
                const studentAttendance = dayAttendance[rowNum] || {};
                
                rowsHTML += `
                    <tr class="${bgClass}" data-row="${rowNum}">
                        <td class="px-2 py-1 text-center">${rowNum}</td>
                        <td class="px-2 py-1 name-column">
                            <input type="text" class="w-full border-0 bg-transparent focus:outline-none focus:ring-1 focus:ring-blue-500 rounded name-field" value="${student.name}">
                        </td>
                        <td class="px-2 py-1 text-center class-column">
                            <input type="text" class="w-full border-0 bg-transparent focus:outline-none focus:ring-1 focus:ring-blue-500 rounded text-center name-field" value="${student.classYear}" style="max-width: 60px;">
                        </td>
                `;
                
                // Morning duty checkboxes
                for (let j = 0; j < 4; j++) {
                    const statusType = statusTypes[j];
                    const isChecked = studentAttendance.morning === statusType;
                    rowsHTML += `
                        <td class="px-2 py-1 text-center status-column">
                            <div class="checkbox ${isChecked ? statusType : ''}" data-status="${statusType}" data-period="morning"></div>
                        </td>
                    `;
                }
                
                // Evening duty checkboxes
                for (let j = 0; j < 4; j++) {
                    const statusType = statusTypes[j];
                    const isChecked = studentAttendance.evening === statusType;
                    rowsHTML += `
                        <td class="px-2 py-1 text-center status-column">
                            <div class="checkbox ${isChecked ? statusType : ''}" data-status="${statusType}" data-period="evening"></div>
                        </td>
                    `;
                }
                
                // Note column
                rowsHTML += `
                        <td class="px-2 py-1 note-column">
                            <input type="text" class="w-full border-0 bg-transparent focus:outline-none focus:ring-1 focus:ring-blue-500 rounded name-field" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." value="${studentAttendance.note || ''}">
                        </td>
                    </tr>
                `;
            });
            
            // Add empty rows if needed to reach at least 7 rows
            const emptyRowsNeeded = Math.max(0, 7 - students.length);
            for (let i = 0; i < emptyRowsNeeded; i++) {
                const rowNum = students.length + i + 1;
                const bgClass = rowNum % 2 === 0 ? 'bg-blue-50' : 'bg-white';
                const studentAttendance = dayAttendance[rowNum] || {};
                
                rowsHTML += `
                    <tr class="${bgClass}" data-row="${rowNum}">
                        <td class="px-2 py-1 text-center">${rowNum}</td>
                        <td class="px-2 py-1 name-column">
                            <input type="text" class="w-full border-0 bg-transparent focus:outline-none focus:ring-1 focus:ring-blue-500 rounded name-field" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•..." value="${studentAttendance.name || ''}">
                        </td>
                        <td class="px-2 py-1 text-center class-column">
                            <input type="text" class="w-full border-0 bg-transparent focus:outline-none focus:ring-1 focus:ring-blue-500 rounded text-center name-field" placeholder="‡∏ä‡∏±‡πâ‡∏ô..." style="max-width: 60px;" value="${studentAttendance.classYear || ''}">
                        </td>
                `;
                
                // Morning duty checkboxes
                for (let j = 0; j < 4; j++) {
                    const statusType = statusTypes[j];
                    const isChecked = studentAttendance.morning === statusType;
                    rowsHTML += `
                        <td class="px-2 py-1 text-center status-column">
                            <div class="checkbox ${isChecked ? statusType : ''}" data-status="${statusType}" data-period="morning"></div>
                        </td>
                    `;
                }
                
                // Evening duty checkboxes
                for (let j = 0; j < 4; j++) {
                    const statusType = statusTypes[j];
                    const isChecked = studentAttendance.evening === statusType;
                    rowsHTML += `
                        <td class="px-2 py-1 text-center status-column">
                            <div class="checkbox ${isChecked ? statusType : ''}" data-status="${statusType}" data-period="evening"></div>
                        </td>
                    `;
                }
                
                // Note column
                rowsHTML += `
                        <td class="px-2 py-1 note-column">
                            <input type="text" class="w-full border-0 bg-transparent focus:outline-none focus:ring-1 focus:ring-blue-500 rounded name-field" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." value="${studentAttendance.note || ''}">
                        </td>
                    </tr>
                `;
            }
            
            return rowsHTML;
        }
        
        // Update date picker
        function updateDatePicker() {
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            document.getElementById('date-picker').value = `${year}-${month}-${day}`;
        }
        
        // Show active day and gate
        function showActiveDayGate() {
            document.querySelectorAll('.day-page').forEach(page => {
                page.classList.remove('active');
            });
            
            const activePage = document.getElementById(`day-${activeDay}-gate-${activeGate}`);
            if (activePage) {
                activePage.classList.add('active');
            }
            
            // Update gate navigation buttons
            document.querySelectorAll('.gate-nav').forEach((btn, index) => {
                if (index + 1 === activeGate) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Update day navigation buttons
            document.querySelectorAll('.day-nav').forEach((btn, index) => {
                if (index + 1 === activeDay) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        // Navigate to previous day
        function goToPreviousDay() {
            activeDay--;
            if (activeDay < 1) {
                // Go to previous week's Friday
                mondayDate.setDate(mondayDate.getDate() - 7);
                weekDates = getWeekDates(mondayDate);
                activeDay = 5;
                createDayGatePages();
            }
            
            currentDate = weekDates[activeDay - 1];
            updateDatePicker();
            showActiveDayGate();
        }
        
        // Navigate to next day
        function goToNextDay() {
            activeDay++;
            if (activeDay > 5) {
                // Go to next week's Monday
                mondayDate.setDate(mondayDate.getDate() + 7);
                weekDates = getWeekDates(mondayDate);
                activeDay = 1;
                createDayGatePages();
            }
            
            currentDate = weekDates[activeDay - 1];
            updateDatePicker();
            showActiveDayGate();
        }
        
        // Generate student list for the modal
        function generateStudentList(filterDay = 'all') {
            const tbody = document.getElementById('student-list-body');
            tbody.innerHTML = '';
            
            // For each day
            for (let day = 1; day <= 5; day++) {
                if (filterDay !== 'all' && parseInt(filterDay) !== day) continue;
                
                // For each gate
                for (let gate = 1; gate <= 2; gate++) {
                    const students = studentData[day] && studentData[day][gate] ? studentData[day][gate] : [];
                    
                    // For each student
                    students.forEach((student, index) => {
                        const row = document.createElement('tr');
                        
                        // Get attendance status
                        const dateKey = formatThaiDate(weekDates[day - 1]);
                        const key = `${dateKey}-${gate}`;
                        const rowNum = index + 1;
                        const studentAttendance = attendanceData[key] && attendanceData[key][rowNum] ? attendanceData[key][rowNum] : {};
                        
                        // Determine status text
                        let statusText = '';
                        if (studentAttendance.morning && studentAttendance.evening) {
                            if (studentAttendance.morning === '‡∏°‡∏≤' && studentAttendance.evening === '‡∏°‡∏≤') {
                                statusText = '‚úÖ ‡∏°‡∏≤‡∏Ñ‡∏£‡∏ö';
                            } else if (studentAttendance.morning === '‡∏Ç‡∏≤‡∏î' || studentAttendance.evening === '‡∏Ç‡∏≤‡∏î') {
                                statusText = '‚ùå ‡∏Ç‡∏≤‡∏î';
                            } else if (studentAttendance.morning === '‡∏™‡∏≤‡∏¢' || studentAttendance.evening === '‡∏™‡∏≤‡∏¢') {
                                statusText = '‚è∞ ‡∏™‡∏≤‡∏¢';
                            } else {
                                statusText = 'üìë ‡∏•‡∏≤';
                            }
                        } else {
                            statusText = '‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ';
                        }
                        
                        row.innerHTML = `
                            <td>${thaiDayNames[day]}</td>
                            <td>${gateNames[gate - 1]}</td>
                            <td>${rowNum}</td>
                            <td>${student.name}</td>
                            <td>${student.classYear}</td>
                            <td>${statusText}</td>
                        `;
                        
                        tbody.appendChild(row);
                    });
                }
            }
        }
        
        // Generate data list for the data management modal
        function generateDataList() {
            const dataList = document.getElementById('data-list');
            dataList.innerHTML = '';
            
            // Check if there's any data
            if (Object.keys(attendanceData).length === 0) {
                dataList.innerHTML = '<div class="p-4 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</div>';
                return;
            }
            
            // Sort keys by date
            const sortedKeys = Object.keys(attendanceData).sort();
            
            // Create an item for each date-gate
            sortedKeys.forEach(key => {
                // Skip non-object entries
                if (typeof attendanceData[key] !== 'object' || attendanceData[key] === null) return;
                
                // Parse the key to get date and gate
                const [date, gate] = key.split('-');
                
                // Count students with data
                let studentCount = 0;
                for (const rowNum in attendanceData[key]) {
                    if (rowNum !== 'dutyHead' && rowNum !== 'teacher' && attendanceData[key][rowNum].name) {
                        studentCount++;
                    }
                }
                
                // Create the item
                const item = document.createElement('div');
                item.className = 'data-item';
                item.innerHTML = `
                    <div>
                        <span class="font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${date}</span>
                        <span class="ml-2">‡∏à‡∏∏‡∏î‡πÄ‡∏ß‡∏£: ${gateNames[gate - 1]}</span>
                        <span class="ml-2 text-sm text-gray-500">(${studentCount} ‡∏Ñ‡∏ô)</span>
                    </div>
                    <button class="delete-btn" data-key="${key}">‡∏•‡∏ö</button>
                `;
                
                dataList.appendChild(item);
                
                // Add event listener to delete button
                const deleteBtn = item.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', function() {
                    const key = this.getAttribute('data-key');
                    
                    Swal.fire({
                        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${date} ‡∏à‡∏∏‡∏î‡πÄ‡∏ß‡∏£ ${gateNames[gate - 1]} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Delete data
                            delete attendanceData[key];
                            saveToLocalStorage();
                            
                            // Refresh the data list
                            generateDataList();
                            
                            // Refresh the current page
                            createDayGatePages();
                            showActiveDayGate();
                            
                            Swal.fire({
                                icon: 'success',
                                title: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                                text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                            });
                        }
                    });
                });
            });
        }
        
        // Save data to Google Sheets
        function saveDataToGoogleSheets() {
            // Show loading
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            // Save to localStorage first
            if (!saveToLocalStorage()) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ',
                    text: '‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                });
                return;
            }
            
            // Prepare data for Google Sheets
            const dataToSend = {
                attendanceData: attendanceData,
                timestamp: new Date().toISOString()
            };
            
            // Send data to Google Sheets
            sendToGoogleSheets(dataToSend)
                .then(response => {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÉ‡∏ô Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                })
                .catch(error => {
                    console.error('Error saving to Google Sheets:', error);
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets ‡πÑ‡∏î‡πâ',
                        text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                });
        }
        
        // View Google Sheet
        function viewGoogleSheet() {
            window.open(SHEET_URL, '_blank');
        }
        
        // Initialize
        loadFromLocalStorage();
        createDayGatePages();
        updateDatePicker();
        showActiveDayGate();
        
        // Event listeners
        document.getElementById('prev-day').addEventListener('click', goToPreviousDay);
        document.getElementById('next-day').addEventListener('click', goToNextDay);
        
        document.getElementById('date-picker').addEventListener('change', (e) => {
            const selectedDate = new Date(e.target.value);
            const day = selectedDate.getDay();
            
            if (day === 0 || day === 6) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏ß‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ñ‡∏∂‡∏á‡∏®‡∏∏‡∏Å‡∏£‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                });
                return;
            }
            
            currentDate = selectedDate;
            mondayDate = getMonday(currentDate);
            weekDates = getWeekDates(mondayDate);
            activeDay = day;
            
            createDayGatePages();
            showActiveDayGate();
        });
        
        // Day navigation buttons
        document.querySelectorAll('.day-nav').forEach(button => {
            button.addEventListener('click', () => {
                const day = parseInt(button.getAttribute('data-day'));
                activeDay = day;
                currentDate = weekDates[activeDay - 1];
                updateDatePicker();
                showActiveDayGate();
            });
        });
        
        // Gate navigation buttons
        document.querySelectorAll('.gate-nav').forEach(button => {
            button.addEventListener('click', () => {
                const gate = parseInt(button.getAttribute('data-gate'));
                activeGate = gate;
                showActiveDayGate();
            });
        });
        
        // Save button
        document.getElementById('save-btn').addEventListener('click', saveDataToGoogleSheets);
        
        // Print button
        document.getElementById('print-btn').addEventListener('click', () => {
            window.print();
        });
        
        // View Google Sheet button
        document.getElementById('view-sheet-btn').addEventListener('click', viewGoogleSheet);
        
        // Show student list button
        document.getElementById('show-student-list').addEventListener('click', () => {
            generateStudentList();
            document.getElementById('student-list-modal').classList.remove('hidden');
        });
        
        // Close student list button
        document.getElementById('close-student-list').addEventListener('click', () => {
            document.getElementById('student-list-modal').classList.add('hidden');
        });
        
        // Day filter buttons
        document.querySelectorAll('.day-filter').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.day-filter').forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');
                
                const day = button.getAttribute('data-day');
                generateStudentList(day);
            });
        });
        
        // Manage data button
        document.getElementById('manage-data-btn').addEventListener('click', () => {
            generateDataList();
            document.getElementById('data-management-modal').classList.remove('hidden');
        });
        
        // Close data management button
        document.getElementById('close-data-management').addEventListener('click', () => {
            document.getElementById('data-management-modal').classList.add('hidden');
        });
        
        // Refresh data list button
        document.getElementById('refresh-data-list').addEventListener('click', () => {
            generateDataList();
        });
        
        // Delete all data button
        document.getElementById('delete-all-data').addEventListener('click', () => {
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Delete all data
                    attendanceData = {};
                    saveToLocalStorage();
                    
                    // Refresh the data list
                    generateDataList();
                    
                    // Refresh the current page
                    createDayGatePages();
                    showActiveDayGate();
                    
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'95ac89f014d47b4a',t:'MTc1MTc3ODAzMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
